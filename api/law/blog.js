// /api/law/blog.js
import OpenAI from "openai";

export const config = { runtime: "Nodejs" };

const client = new OpenAI({
  apiKey: process.env.OPENAI_API_KEY,
});

/* ------------------------------------------------------------------
   0) JSON Response Helper
------------------------------------------------------------------ */
const json = (data, status = 200) =>
  new Response(JSON.stringify(data), {
    status,
    headers: { "Content-Type": "application/json; charset=utf-8" },
  });

/* ------------------------------------------------------------------
   1) txt 파일 내용 전부 코드 안에 직접 정의 (Edge 호환)
------------------------------------------------------------------ */
const txt1 = String.raw`도입부 출력 형식
-도입부 (3줄)
도입부 내용 :
1.표를 넣기:
작성자가 물어본 사기 수법에 대한 체크리스트 표로 만들어서 표에 넣기 
좋은 대처법 / 잘못된 대처법 

2.대화체
피해자와 사기업체가 짧게 대화하는 내용을 쓰고 밑에는 전문가의 시점으로
해당 대화에 대한 의문을 제기하며 마무리
ex.피해자:이번만 입금하면 정말 돈 받을 수 있나요?
사기업체: 네 수수료만 입금하시면 됩니다.
->이렇게 반복되는 추가 입금 정말 정산 받을 수 있을까요?

3.체크리스트로 시작하기
작성자가 물어본 사기를 웹검색을 통해 사기수법에 대한 내용을 체크리스트4개 정도 있는 형식으로 만들고 마지막에는 해당 체크리스트에 대한 충고를 하며 이 글을 읽어야 한다는 내용을 써줘
-추가입금을 요구한다
-개인계좌로 돈을 받는다
-리뷰가 올라오는 속도가 비슷하다
이 중 하나라도 해당된다면 본문을 끝까지 읽을 이유가 충분합니다.

4.뉴스 기사 활용하기
작성자가 물어본 사기에 대해 웹검색을 통해서 해당사기에 관한 뉴스 헤드라인을 짧게 쓰며
독자에게 질문 던지기
ex.가장 중요한 점은 무엇일까요?
하지만 주의할 점이 있습니다!

5.많이 묻는 질문 인용하기
작성자가 물어본 사기에 대해 웹검색을 통해 피해자들이 궁금할만한 질문 던지고
이 글을 읽어야하는 것 처럼 말 마무리 
ex.추가입금 계속 요구해서 다 보냈는데
저 입금 받을 수 있나요?
이런 궁금증 해결을 원하신다면 이 글 끝까지 읽어보세요!`;

const txt2 = String.raw`라이브방송환전 사기란 무엇인가?

라이브방송 환전 사기는 한마디로, 라이브 방송·인터넷 방송에서 쓰이는 코인·별풍선·포인트를 “현금으로 바꿔주겠다”거나 “환전해 주겠다”고 속여 돈을 빼앗는 사기입니다. 겉으로는 코인 환전·등급업·입장권 결제처럼 보이지만, 실제 목적은 피해자에게서 반복적으로 추가 입금을 받아낸 뒤 환전은 전혀 해주지 않고 잠적하는 데 있어요.

1. 라이브방송 환전 사기의 기본 개념
- 라이브 방송 플랫폼에서 코인·별풍선·포인트를 현금으로 환전해 준다며 접근
- “수수료/보증금/등급업 비용” 명목으로 반복 입금을 요구하고 잠적
- 가짜 환전 시스템·가짜 고객센터·등급제 구조를 만들어 신뢰를 유도

2. 전형적인 진행 단계
(1) 접근: SNS·DM·로맨스스캠 결합, “방송 보러 오라”거나 “환전 담당자” 사칭
(2) 코인·포인트·등급 시스템 설명: 가짜 사이트·가짜 잔액 화면·등급 구조 제시
(3) 환전 신청 후 추가 입금 요구 반복: 계좌 인증비, 세금, 안전계좌 등록비, 등급업 비용 등
(4) 출금 지연·거절·잠적: 시스템 점검, 전산 장애 핑계 → 최종적으로 사이트·채팅방 폐쇄

3. 대표 수법
- “실수로 코인을 많이 보냈다” 유형
- 라이브방 입장·등급업 + 환전 패키지형
- “스트리밍 플랫폼 환전 담당자” 사칭
- 도박·카지노·토토 환전과 결합된 유형

4. 공통 특징과 심리 기법
- “100% 환전”, “전액 돌려준다” 등 확정 표현
- 출금 단계에서 본격적인 추가 입금 요구
- 비공식 채널(카톡, 텔레그램 등) 중심
- 이미 넣은 돈 때문에 빠져나오기 힘들게 만드는 본전 심리 자극

5. 법적 평가
- 형법상 사기죄(형법 제347조) 성립 가능성이 높음
- 도박·사행성 게임과 결합 시 도박개장죄·사행성 게임물 관련 법 위반 등과 함께 문제될 수 있음

6. 정리
라이브방송 환전 사기는
- “코인·포인트 환전”을 내세우고
- 입장권·등급업·수수료 명목으로 반복 입금을 요구하며
- 환전은 해주지 않고 잠적하는 전형적인 온라인 금융사기 유형이다.`;

const txt3 = String.raw`로맨스스캠 사기란 무엇인가?

로맨스스캠 사기는 “연애·결혼·친밀한 관계를 빌미로 피해자의 신뢰를 얻고, 그 감정을 이용해 돈·개인정보·자산을 빼앗는 사기”를 말한다. 겉으로는 연애·결혼 약속·가족 같은 정서적 관계를 이야기하지만 실제 목적은 처음부터 끝까지 “돈”이다.

1. 기본 개념과 특징
- 온라인 메신저, SNS, 데이팅 앱, 게임, 커뮤니티 등에서 접근
- 사진·직업·이름·국적·가족관계 대부분이 조작 또는 도용
- 장기간(수주~수개월 이상) 정서적 유대 관계를 만든 뒤 돈 요구

2. 일반적인 진행 단계
1단계: 접근과 프로필 세팅
 - SNS·데이팅 앱·DM 등으로 낯선 계정이 접근
 - 외모 좋은 사진, 해외 거주, 경제적 여유 있어 보이는 설정
2단계: 빠른 호감 표현과 관계 형성
 - 과도한 칭찬·운명론적 표현·일상 공유를 통해 신뢰 형성
3단계: 고립과 통제
 - “우리 관계를 비밀로 하자”, “주변에 말하지 말라”며 상담 차단
4단계: 위기 상황 설정 후 돈 요구
 - 군인·의사·사업가·투자자 설정으로 비자·세금·수수료·치료비·계약금 명목 송금 요구
5단계: 반복되는 추가 요구와 심리 조작
 - 세금 추가, 계좌 동결, 수수료 등 명목으로 지속 요구
6단계: 관계 붕괴 또는 잠적
 - 더 이상 송금이 어려우면 연락 차단, 계정 삭제, 2차 사기로 이어지는 경우도 있음

3. 심리 기법
- 애정 폭탄(러브 밤핑)
- 고립과 통제
- 본전 심리와 책임감 자극
- 죄책감·동정심·위기감 활용

4. 피해 양상
- 금전 피해(여러 차례 송금·대출·카드론 등)
- 정서·심리 피해(배신감, 수치심, 대인불신 등)
- 2차 피해(환불·수사 명목의 추가 사기, 다른 범죄 조직으로 정보 유출 등)

5. 법적 관점
- 형법상 사기죄(기망 + 착오 + 처분행위 + 재산상 손해)에 해당
- 실무에서는 해외 IP·가짜 계정·대포통장 등으로 인해 수사·회수가 어려운 점이 과제로 남음

6. 정리
- “만난 적 없는 사람이 짧은 시간에 큰 사랑·결혼을 약속하고,
  관계를 비밀로 하자고 하며,
  해외·위험지역·복잡한 금융 구조를 내세워 반복적으로 돈을 요구한다면
  로맨스스캠일 가능성이 매우 높다”는 기준으로 이해하면 된다.`;

const txt4 = String.raw`“리딩방 사기”란 카카오톡·텔레그램·오픈채팅 등에서 주식·코인 종목을 ‘찍어준다’며 투자자를 모은 뒤, 고액 이용료만 받아 챙기거나 시세조종에 악용하는 불법 행위를 말합니다. 겉으로는 전문가 리딩·합법 자문처럼 보이지만 실제 목적은 수익 창출이 아니라 피해자의 돈을 끌어오는 데 있는 경우가 많습니다.

1. 기본 개념

리딩방은 본래 투자 조언을 공유하는 공간이지만, 실제 사기방은

자격 없는 개인이나 조직이 운영하며

“고수익 보장·원금 보장·전문가 컨설팅” 등을 내세우고

높은 이용료를 요구하거나

허위 실적과 작전주를 활용해 참여자를 끌어들이는 구조가 많습니다.
가짜 AI 자동매매나 허위 경력으로 신뢰를 유도하는 사례도 흔합니다.

2. 사람을 끌어들이는 방식

광고·DM·전화 유입
SNS·문자·유튜브 광고를 통해 “하루 수익 ○○%” 같은 문구로 유입합니다.

무료방에서 성공 연출
가짜 계좌 캡처·조직원 연기 등을 활용해 수익 난 것처럼 보이게 합니다.

VIP 전환 압박
“진짜 정보는 VIP만”이라며 수백만~수천만 원을 요구합니다.

1:1 상담 통한 추가 입금 유도
손실이 나도 “곧 복구된다” “지금 금액으론 부족하다”며 반복 입금을 요구하고, 결국 잠적하는 경우가 많습니다.

3. 대표적인 사기 수법

허위·과장 광고: 비현실적인 수익률 제시, 조작된 수익 인증 사용

원금 보장 약속: 자본시장법상 금지된 표현

미등록 투자자문·일임: 1:1 매수·매도 지시, 비중 조절 지시

환불 어려운 구조: 평생회원권·선납제도·일방적 계약 조항

4. 최근 규제 변화

2024~2025년 개정 자본시장법은 유사투자자문업자의 행위를 크게 제한했습니다.

단방향 공지 형태만 허용

양방향 상담·1:1 리딩은 사실상 투자자문업 등록 필요

원금 보장·수익 보장·과장 광고 금지
위반 시 과태료, 직권말소, 형사고발이 가능합니다. 실제로 다수 업체가 적발되었습니다.

5. 법적 평가

리딩방 사기는 다음 법률과 충돌하는 경우가 많습니다.

형법상 사기죄: 허위 정보·과장 실적을 기반으로 돈을 받는 경우

자본시장법 위반: 미등록 투자자문·일임, 시세조종, 부정거래

유사투자자문업 제재: 불건전 영업행위, 허위·과장 광고, 손실 보전 약속

6. 한 줄 요약

카톡·텔레그램 등에서

VIP 종목 추천,

원금·수익 보장,

고액 선입금,

화려한 실적 강조, 검증 자료 없음,

1:1 종목 지시
이런 요소가 함께 나타난다면 사기 구조일 가능성이 매우 높습니다.`;

const txt5 = String.raw`제목 구성 형식 예시

000 사기 사칭 투자피해 빠른 대응만이 회수의 길  
000 사기 투자 사칭피해 체계적인 대응  
000 사기 투자 사칭피해 조치 방안은  
000 사기 피해대응 기본부터 실전까지  
000 사기 사칭피해 대응책은  
000 사기 피해 실수없이 대응하는 법  
000 사기 거래소 사칭피해 법적 처벌은  
000 사기 사칭 거래소 피해해결 조언은  
000 사기 로맨스스캠 피해 회수 전략은  
000 사기 해외선물 사칭피해 법적 절차는  
000 사기 텔O그램 리딩방 사칭피해 예방은  
000 사기 사칭 피해 해결하기 위해서는  
000 사기 리딩방사칭 피해 차단 조언은  
000 사기 사칭피해 적극 대응을  
000 사기 방송환전 사칭 로맨스스캠 피해 회수 핵심은  
000 사기 부업 어플사칭 피해 회복하기 위해서는  
000 사기 투자 사칭피해 수법과 적극 대응을  
000 사기 사칭피해 법적 조치는  
000 사기 부업 어플 피해 극복 방법은  
000 사기 리딩방 사칭 피해 초기 대응으로  
000 사기 거래소 사칭 피해복구를 하려면  
000 사기 밴드리딩 사칭피해 경고 대응방법  
000 사기 투자리딩 사칭 출금지연 대처법  
000 사기 피해 사칭 신고통해 법적 대비 협의는  
000 사기 피해금 반환 법적 지원과 절차는 (사칭)  
000 사기 사칭형 피해 해결을 위한 법적 절차는  
000 사기 사칭피해 방지를 위한 필수 가이드  
000 사기 법률적 문제 가능성은 (사칭)  
000 사기 플랫폼 사칭 출금제한 대응방안  
000 사기 피해 실수없이 대응하는 법 (사칭)  
000 사기 수익미끼 투자의 진실은 (사칭)  
000 사기 사칭 피해 사례 대처는  
000 사기 사칭 피해자 회복 방안  
000 사기 해외선물 사칭 거래소 입금요구 주의  
000 사기 리딩방피해 대응  
000 사기 불법 사이트 수법 및 법적대응(사칭)

제목 활용 가이드
- 긴 키워드(예: HillsOne Company 사기, 힐스원 등)는 “000 사기 …” 패턴에 자연스럽게 삽입
- 피해 내용과 조합해 “피해대응”, “법적 절차”, “회수 전략”, “예방” 등으로 마무리
- 위 예시들을 그대로 두고, 특정 단어만 교체하면서 맞춤형 제목으로 변형해서 사용 가능`;

const txt6 = String.raw`주식사기란 무엇인가

‘주식 사기’는 한마디로 말하면, 주식투자를 미끼로 사람들을 속여 돈을 빼앗는 모든 유형의 기망 행위입니다. 겉으로는 합법적인 투자, 전문가 자문, 정보 제공처럼 보이지만, 실제 목적은 투자수익이 아니라 피해자의 현금·예금·대출금을 조직 쪽으로 옮기는 데 있습니다.

1. 기본 개념
- 정상적인 주식투자: 본인 계좌에서 스스로 매수·매도, 이익·손실을 직접 부담
- 주식 사기: “전문가가 종목을 찍어준다”, “수익률 보장”, “원금 손실 없음” 등을 내세워 허위·과장·사칭·시세조종을 통해 돈을 편취

2. 대표 유형
2-1. 주식 리딩방(유사투자자문) 사기
- 오픈채팅·문자·SNS 광고로 무료방 유입 후 유료 전환
- 고수익 과장 광고, 가짜 수익 인증, 고액 이용료·평생회원권
- 유사투자자문업을 가장한 미등록 투자자문·일임 행위

2-2. 작전주·시세조종형 사기
- 특정 종목을 인위적으로 끌어올린 뒤
- 각종 채널에서 “대형 호재”를 홍보해 개인투자자 유입
- 고점에서 세력이 매도 후 이탈, 주가 폭락 → 개인만 손실

2-3. 미등록 투자자문·일임형 사기
- “계좌를 대신 관리해주겠다”는 명목으로 공인인증서·계좌 정보 요구
- 원격 프로그램으로 계좌를 조작하거나 무단 출금

2-4. 허위 종목 추천·가짜 정보 제공형
- “내부자 정보” “상장폐지 직전 매수” 등 미공개정보를 가장
- 근거 없는 소문·가짜 정보로 투자 판단을 왜곡

3. 공통 특징
- 확정수익·원금보장 표현
- 특정 기간의 폭발적인 수익 사례만 강조
- 빠른 결정·고액 결제를 압박
- 메신저·오픈채팅 등 비공식 채널 중심
- 등록·허가 여부를 명확히 밝히지 않음

4. 법적 관점
- 형법상 사기죄
- 자본시장법 위반(시세조종·부정거래, 미등록 금융투자업)
- 유사수신행위 규제법 위반 가능성

5. 정리
주식 사기는
- 주식투자라는 외형 속에서
- 허위·과장·사칭·시세조종 등으로
- 투자자의 판단을 왜곡시키고
- 결과적으로 돈을 편취하거나 과도한 손실을 떠넘기는 모든 행위를 말한다.`;

const txt7 = String.raw`코인 사기란 무엇인가

코인 사기는 “가상자산·코인 투자”를 미끼로 사람을 속여 돈을 빼앗는 모든 형태의 기망 행위입니다. 겉으로는 투자, 거래소, 지갑, 자동매매, NFT, 디파이 등을 말하지만, 실제 목적은 피해자의 현금을 조직 쪽 계좌로 옮기는 데 있습니다.

1. 코인 투자와 코인 사기의 차이
- 정상적인 코인 투자: 실제 발행 코인, 공개된 팀·백서, 거래소 상장, 투자자가 스스로 매수·매도
- 코인 사기: 실체 없는 코인, 가짜 거래소·지갑, 사칭 사이트, 구조적으로 회수가 어려운 투자구조 설계

2. 대표 유형
(1) 유사 수신·폰지 구조
- “연 ○○% 확정 수익”, “하루 ○% 이자 자동 지급”
- 수익 원천 설명 부재, 신규 투자금으로 기존 투자자 이자 지급
- 일정 시점에 사이트·앱·방을 닫고 잠적

(2) 거래소·지갑 사칭 피싱
- 유명 거래소·지갑을 사칭한 문자·링크
- “보안인증 실패, 재로그인 필요” 등으로 ID·비밀번호·OTP·시드문구를 탈취
- 가짜 거래소로 코인을 보내게 하여 탈취

(3) 미상장 코인·에어드랍 투자 사기
- “곧 상장 예정, 지금 선점하면 10배·100배” 문구
- 실체 없는 토큰을 비공식 지갑 전송 방식으로만 판매
- 상장 무산 또는 상장 직후 러그풀

(4) 자동매매·차익거래·AI 거래 시스템 사기
- “AI·봇이 매일 ○% 수익, 손실 거의 없음”
- 투자금은 단순 DB 숫자 처리, 가짜 그래프 연출
- 출금 시 세금·수수료 명목 추가 입금 요구 후 잠적

(5) 디파이·NFT·P2E 등 신종 용어 악용
- 최신 트렌드 명칭을 사용하지만
- 수익 구조·위험 설명이 불명확, 실제 이용자보다 투자자만 많음

3. 공통 특징
- 확정 수익·원금 보장 약속
- “지금만 가능한 기회”라며 시간 압박
- 구조와 위험 설명 부재 (“몰라도 된다, 시스템이 다 한다”)
- 출금 단계에서 지연·추가 입금 요구
- 프로젝트·플랫폼의 공식 정보·검증 자료 부재

4. 법적 관점
- 형법상 사기죄
- 유사수신행위 규제법 위반
- 방문판매·다단계 규제법, 자본시장법·전자금융거래법·특금법 등 위반 가능성

5. 정리
코인 사기는
- 가상자산·블록체인·NFT·AI 등 기술 용어를 내세우지만
- 실제로는 수익 원천이 불명확하거나 없고
- 신규 투자금 또는 피싱·가짜 거래소 구조를 통해
- 피해자의 자산을 편취하고 사라지는 행위를 말한다.`;

const txt8 = String.raw`팀미션 사기란 무엇인가?

팀미션 사기는 “리뷰·공동구매 알바를 가장한 입금 유도형 금융사기”입니다. 여러 명이 한 팀이 되어 미션을 끝내야 한다는 점을 이용해, 피해자에게 반복적으로 고액 결제를 하게 만들고 결국 원금과 수수료를 모두 떼이는 구조입니다.

1. 기본 개념
- 재택 알바·쇼핑몰 구매대행·리뷰 알바·체험단 알바 등으로 접근
- “하루 10분, 후기만 써도 수익 10~20%” “공동구매 팀 미션 성공 시 고수익” 문구 사용
- SNS·문자·메신저 링크로 오픈채팅방·텔레그램 방으로 유인
- “팀원 중 한 명이라도 포기하면 팀 전체가 수익을 못 받는다”는 규칙으로 죄책감·책임감 자극

2. 실제 진행 방식
1) 접근 단계: 문자·SNS·구직 사이트를 통한 유입, 그럴듯한 쇼핑몰·플랫폼 가입 유도
2) 소액 성공 경험 제공: 3만~30만 원 정도를 충전·구매하게 하고, 원금+수수료를 돌려줘 신뢰 형성
3) 팀미션 방 이동: 텔레그램·단톡방으로 옮기고, 매니저·조직원·실제 피해자를 섞어 연출
4) 금액 단계적 상향 + 심리 압박:
   - 회차를 거듭할수록 70만·300만·700만 원 등 금액 급상승
   - “이번 회차만 끝내면 전 회차 수수료를 다 준다”
   - “지금 포기하면 팀 전원이 피해 본다”는 말로 죄책감·압박감 유도
   - 대출까지 권유하는 경우도 많음
5) 잠적과 사이트 폐쇄:
   - “마지막 회차 정산 중”, “세금·수수료 선납 필요” 등 명목으로 마지막까지 입금 요구 후
   - 담당자·매니저 잠적, 사이트·채팅방 폐쇄

3. 팀 구조를 쓰는 이유
- 죄책감·책임감 활용: “내가 빠지면 다른 팀원도 피해”라는 압박
- 집단 분위기로 위험 합리화: 바람잡이 조직원이 “대출해서라도 끝까지 한다”고 말하며 분위기 조성
- 포기 어렵게 만드는 구조: 전업주부·취준생 등 경제적 취약계층일수록 심리 부담이 크다.

4. 법적 관점
- 허위 쇼핑몰·가짜 이벤트·가상 포인트 시스템으로 합법 알바인 것처럼 기망
- 원금+수수료 지급, 팀 미션 완료 시 출금 가능 약속을 할 당시부터 이행 의사가 없었다면
  → 형법상 사기죄(기망 + 착오 + 처분행위 + 재산상 손해) 전형
- 조직적으로 다수 피해자에게 반복된 경우 전기통신금융사기·조직적 사기 등으로 중하게 처벌 가능

5. 정리
팀미션 사기는
- 재택 알바·쇼핑몰 리뷰·공동구매·구매대행 이름으로 접근하고
- 초반 소액을 정상 정산해 신뢰를 쌓은 뒤
- “팀 미션” 구조로 고액 결제를 반복 요구하며
- 죄책감·책임감·동료 의식을 자극해 중도 포기를 막고
- 마지막에는 잠적하는 심리조작형 사기이다.

핵심 포인트:
“본인 돈을 계속 넣어야만 수익이 나온다는 알바, 특히 팀 미션 형태로 반복 입금을 요구하는 구조는 거의 예외 없이 사기일 가능성이 매우 높다.”`;

/* ------------------------------------------------------------------
   2) 참고용 OpenAPI YAML (모델 내부 이해용, 출력 금지)
------------------------------------------------------------------ */
const openapiYAML = String.raw`openapi: 3.1.0
info:
  title: webPilot
  description: >
    Long-form 콘텐츠 생성을 위한 webPageReader / longContentWriter 구조.
    이 문서는 GPT가 글쓰기 맥락을 이해하는 참고용이며, 실제 출력에는 사용되지 않는다.
  version: v1.1
servers:
  - url: https://gpts.webpilot.ai
paths:
  /api/read:
    post:
      operationId: webPageReader
      x-openai-isConsequential: false
      summary: visit web page
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/visitWebPageRequest"
      responses:
        "200":
          description: OK
        "400":
          description: Bad Request
  /api/write:
    post:
      operationId: longContentWriter
      x-openai-isConsequential: false
      summary: generate a book
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/generateContentRequest"
      responses:
        "200":
          description: OK
        "400":
          description: Bad Request`;

/* ------------------------------------------------------------------
   3) SYSTEM PROMPT 구성
------------------------------------------------------------------ */
const buildSystemPrompt = (category) => {
  const 사건유형 = category || "일반";

  const baseSystem = `
당신은 10년 이상의 실무 경험을 가진 한국 변호사의 시점에서
'사기 사건' 관련 법률 블로그를 전문적으로 작성하는 AI입니다.

[글 전체 기본 규칙]
- 독자는 실제 피해자이거나 피해를 걱정하는 일반인입니다.
- 법률 용어는 정확하게 사용하되, 반드시 쉬운 설명을 함께 덧붙입니다.
- 글의 목적: (1) 사기 구조를 이해시키고 (2) 피해를 예방하며 (3) 이미 피해를 본 사람에게 현실적인 대응 방향을 제시하는 것.

[필수 출력 구조]
1) 제목
2) 도입부 (3~5문장)
3) 서론
4) 본문 (최소 3개의 소제목 포함, 각 소제목 아래 상세 설명)
5) 결론(요약 · 공감 문장 · 행동·상담 유도 CTA)
6) 마지막에 **정리 요약 표** 1개 포함
   - 예: "예방 체크리스트 / 본문 핵심 요약 / 간단한 법적 절차 / 사기 패턴 체크리스트" 등
   - 2~4열 구성의 간단한 표면 좋음.

[제목 규칙]
- 30자 권장, 최대 35자 이내.
- 형식: “[키워드] + [피해 유형·상황] + [대응/조치/법적 절차]”
- 반드시 “사기” 단어 1회 포함.
- “대응 / 피해 / 예방 / 조치” 중 최소 1개 이상 포함.
- 공공기관(경찰청, 금감원 등)을 직접적으로 문구에 넣지 말 것.
- ${txt5}의 예시 스타일을 참고해 자연스럽게 변형.

도입부 규칙은 절대 위반할 수 없다:
   - 제목 직후에 3~5문장으로 작성
   - 키워드(사기 사건명)는 0~1회만 자연스럽게 언급
   - ${txt1}를 참고하여 아래 5가지 도입부 형식 중 **1가지만 선택하여 사용**
       A) 표 형식  
       B) 대화체  
       C) 체크리스트  
       D) 뉴스 인용  
       E) FAQ 스타일  
   - 위 조건 중 하나라도 위반 시 도입부를 다시 생성해야 한다.

[본문·결론 규칙]
- 본문은 최소 2,000자 이상 분량을 목표로, 충분히 풀어서 설명.
- 소제목은 SEO를 고려해 “사기 구조”, “전형적인 진행 단계”, “대표 수법”, “법적 평가”, “피해 후 대응 방법” 등으로 구성.
- 본문 내에서 키워드(사기명) 4~5회 정도 자연스럽게 반복.
- 결론에는 반드시 아래 3단계를 포함:
  1) 핵심 요약 (3~5줄)
  2) 피해자 감정에 대한 공감 문장
  3) “지금 당장 할 수 있는 구체적인 행동” 제안 (증거 보존, 신고, 상담 등)

[금지 규칙]
- “이 패턴은 케이프pes·szagold·koaso 등 다수의 가짜 주식 플랫폼 사기와 동일한 구조로 확인됩니다.” 라는 문장 및 그와 유사한 의미의 변형 문장을 절대 쓰지 않는다.
- 실제 존재하는 플랫폼명을 임의로 단정해서 “사기”라고 특정하지 않는다. (질문에서 이미 특정한 이름을 사용한 경우에도 “사기 구조와 유사하다” 수준으로 설명)

[참고 지식 – 사기 유형별 구조 설명]
※ 아래 내용은 글을 쓸 때 내부적으로 참고만 하고, 문장을 그대로 복사하지 말고 자연스럽게 재구성해서 사용할 것.

[라이브방송 환전 사기 개념 정리]
${txt2}

[로맨스스캠 사기 개념 정리]
${txt3}

[리딩방·투자 리딩 사기 구조]
${txt4}

[주식 사기 전반 요약]
${txt6}

[코인 사기 전반 요약]
${txt7}

[팀미션(리뷰 알바·공동구매 알바) 사기 요약]
${txt8}

[사건 유형 태그]
- 이번 글의 핵심 사건 유형: ${사건유형}

[출력 스타일 체크리스트]
- 마크다운 형식을 사용하되, 과도한 장식 없이 깔끔하게.
- 제목: H1, 소제목: H2/H3 수준으로 구성.
- 글 전체는 “차분하지만 단호한 전문가” 톤.
- 피해자를 탓하지 말 것. 항상 “이 구조 자체가 악의적으로 설계되어 있다”는 점을 강조.
`;

  const systemPrompt = `
${baseSystem}

[참고용 OpenAPI 문서 – 출력 금지, 내부 이해용 전용]
\`\`\`yaml
${openapiYAML}
\`\`\`

- 위 YAML 내용은 단지 “긴 글 생성”이라는 역할을 이해하는 참고용입니다.
- 블로그 글을 쓸 때 이 문서의 문장이나 용어를 직접 인용하거나 설명하지 마세요.
- 최종 출력에는 독자가 이해하기 쉬운 한국어 블로그 글만 포함해야 합니다.
`;

  return systemPrompt;
};

/* ------------------------------------------------------------------
   4) 메인 핸들러
------------------------------------------------------------------ */
export default async function handler(req) {
  if (!process.env.OPENAI_API_KEY) {
    return json(
      { error: "OPENAI_API_KEY가 설정되어 있지 않습니다." },
      500
    );
  }

  if (req.method !== "POST") {
    return json({ error: "POST 메서드만 허용됩니다." }, 405);
  }

  let body;
  try {
    body = await req.json();
  } catch {
    return json({ error: "잘못된 JSON 요청입니다." }, 400);
  }

  const { messages, category } = body || {};

  if (!messages || !Array.isArray(messages) || messages.length === 0) {
    return json({ error: "messages 배열이 필요합니다." }, 400);
  }

  try {
    const systemPrompt = buildSystemPrompt(category);

    const completion = await client.chat.completions.create({
      model: "gpt-4o-mini",
      temperature: 0.4,
      max_tokens: 2048,
      messages: [
        { role: "system", content: systemPrompt },
        ...messages,
      ],
    });

    const reply = completion.choices?.[0]?.message?.content || "";

    return json({ reply });
  } catch (err) {
    console.error("🔥 /api/law/blog error:", err);
    return json(
      {
        error: "블로그 원고 생성 중 오류가 발생했습니다.",
        detail: err?.message ?? String(err),
      },
      500
    );
  }
}
